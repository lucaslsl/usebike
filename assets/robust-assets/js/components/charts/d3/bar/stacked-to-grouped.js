$(window).on("load",function(){function a(){clearTimeout(x),"grouped"===this.value?b():c()}function b(){q.domain([0,n]),w.transition().duration(500).delay(function(a,b){return 10*b}).attr("x",function(a,b,c){return p(a.x)+p.rangeBand()/j*c}).attr("width",p.rangeBand()/j).transition().attr("y",function(a){return q(a.y)}).attr("height",function(a){return i-q(a.y)})}function c(){q.domain([0,o]),w.transition().duration(500).delay(function(a,b){return 10*b}).attr("y",function(a){return q(a.y0+a.y)}).attr("height",function(a){return q(a.y0)-q(a.y0+a.y)}).transition().attr("x",function(a){return p(a.x)}).attr("width",p.rangeBand())}function d(a,b){function c(b){for(var c=1/(.1+Math.random()),d=2*Math.random()-.5,e=10/(.1+Math.random()),f=0;f<a;f++){var g=(f/a-d)*e;b[f]+=c*Math.exp(-g*g)}}var d,e=[];for(d=0;d<a;++d)e[d]=b+b*Math.random();for(d=0;d<5;++d)c(e);return e.map(function(a,b){return{x:b,y:Math.max(0,a)}})}function e(){h=f.node().getBoundingClientRect().width-g.left-g.right,t.attr("width",h+g.left+g.right),u.attr("width",h+g.left+g.right),p.rangeRoundBands([0,h],.08),u.selectAll(".d3-xaxis").call(s),u.selectAll(".d3-bar").attr("x",function(a){return p(a.x)})}var f=d3.select("#stacked-to-grouped"),g={top:20,right:20,bottom:30,left:50},h=f.node().getBoundingClientRect().width-g.left-g.right,i=500-g.top-g.bottom,j=4,k=58,l=d3.layout.stack(),m=l(d3.range(j).map(function(){return d(k,.1)})),n=d3.max(m,function(a){return d3.max(a,function(a){return a.y})}),o=d3.max(m,function(a){return d3.max(a,function(a){return a.y0+a.y})}),p=d3.scale.ordinal().domain(d3.range(k)).rangeRoundBands([0,h],.08),q=d3.scale.linear().domain([0,o]).range([i,0]),r=d3.scale.linear().domain([0,j-1]).range(["#FECEA8","#E84A5F"]),s=d3.svg.axis().scale(p).tickSize(0).tickPadding(6).orient("bottom"),t=f.append("svg"),u=t.attr("width",h+g.left+g.right).attr("height",i+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")"),v=u.selectAll(".layer").data(m).enter().append("g").attr("class","layer").style("fill",function(a,b){return r(b)}),w=v.selectAll(".d3-bar").data(function(a){return a}).enter().append("rect").attr("class","d3-bar").attr("x",function(a){return p(a.x)}).attr("y",i).attr("width",p.rangeBand()).attr("height",0);w.transition().delay(function(a,b){return 10*b}).attr("y",function(a){return q(a.y0+a.y)}).attr("height",function(a){return q(a.y0)-q(a.y0+a.y)}),u.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+i+")").call(s),d3.selectAll("input").on("change",a);var x=setTimeout(function(){d3.select('input[value="grouped"]').property("checked",!0).each(a)},2e3);$(window).on("resize",e),$(".menu-toggle").on("click",e)});