$(window).on("load",function(){function a(){d=b.node().getBoundingClientRect().width-c.left-c.right,p.attr("width",d+c.left+c.right),q.attr("width",d+c.left+c.right),k.rangeRoundBands([0,d],.1,0),q.selectAll(".d3-xaxis").call(l),q.selectAll(".d3-bar").attr("x",function(a){return k(a.date)}).attr("width",k.rangeBand())}var b=d3.select("#stacked-to-multiples"),c={top:20,right:20,bottom:30,left:60},d=b.node().getBoundingClientRect().width-c.left-c.right,e=500-c.top-c.bottom,f=d3.time.format("%Y-%m").parse,g=d3.format("02d"),h=function(a){return"Q"+((a.getMonth()/3|0)+1)+g(a.getFullYear()%100)},i=d3.scale.ordinal().rangeRoundBands([e,0],.2),j=d3.scale.linear(),k=d3.scale.ordinal().rangeRoundBands([0,d],.1,0),l=d3.svg.axis().scale(k).orient("bottom").tickFormat(h),m=d3.nest().key(function(a){return a.group}),n=d3.layout.stack().values(function(a){return a.values}).x(function(a){return a.date}).y(function(a){return a.value}).out(function(a,b){a.valueOffset=b}),o=d3.scale.ordinal().range(["#99B898","#FECEA8","#FF847C","#E84A5F"]),p=b.append("svg"),q=p.attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")");d3.tsv("robust-assets/demo-data/d3/bar/stacked-to-multiples.tsv",function(a,b){function c(){clearTimeout(p),"multiples"===this.value?d():e()}function d(){var a=q.transition().duration(750),b=a.selectAll(".d3-bar-group").attr("transform",function(a){return"translate(0,"+i(a.key)+")"});b.selectAll(".d3-bar").attr("y",function(a){return j(a.value)}),b.select(".d3-group-label").attr("y",function(a){return j(a.values[0].value/2)})}function e(){var a=q.transition().duration(750),b=a.selectAll(".d3-bar-group").attr("transform","translate(0,"+i(i.domain()[0])+")");b.selectAll(".d3-bar").attr("y",function(a){return j(a.value+a.valueOffset)}),b.select(".d3-group-label").attr("y",function(a){return j(a.values[0].value/2+a.values[0].valueOffset)})}if(a)throw a;b.forEach(function(a){a.date=f(a.date),a.value=+a.value});var g=m.entries(b);n(g),k.domain(g[0].values.map(function(a){return a.date})),i.domain(g.map(function(a){return a.key})),j.domain([0,d3.max(b,function(a){return a.value})]).range([i.rangeBand(),0]);var h=q.selectAll(".d3-bar-group").data(g).enter().append("g").attr("class","d3-bar-group").attr("transform",function(a){return"translate(0,"+i(a.key)+")"});h.append("text").attr("class","d3-group-label").attr("x",-60).attr("y",function(a){return j(a.values[0].value/2)}).attr("dy",".35em").text(function(a){return"Group "+a.key}),h.selectAll(".d3-bar").data(function(a){return a.values}).enter().append("rect").attr("class","d3-bar").style("fill",function(a){return o(a.group)}).attr("x",function(a){return k(a.date)}).attr("y",function(a){return j(a.value)}).attr("width",k.rangeBand()).attr("height",function(a){return i.rangeBand()-j(a.value)}),h.filter(function(a,b){return!b}).append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+i.rangeBand()+")").call(l),d3.selectAll(".smradio").on("change",c);var p=setTimeout(function(){d3.select('input[value="stacked"]').property("checked",!0).each(c)},2e3)}),$(window).on("resize",a),$(".menu-toggle").on("click",a)});