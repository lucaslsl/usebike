$(window).on("load",function(){function a(a){return a.value=+a.value,a}function b(a){a=Math.round(a);var b=a;return Math.abs(a)>1e3&&(b=Math.round(a/1e3)+"K"),"$"+b}function c(){f=d.node().getBoundingClientRect().width-e.left-e.right,l.attr("width",f+e.left+e.right),m.attr("width",f+e.left+e.right),h.rangeRoundBands([0,f],padding),m.selectAll(".d3-xaxis").call(j),m.selectAll(".d3-bar").attr("transform",function(a){return"translate("+h(a.name)+",0)"}),m.selectAll(".d3-bar rect").attr("width",h.rangeBand()),m.selectAll(".d3-bar text").attr("x",h.rangeBand()/2),m.selectAll(".d3-connector").attr("x1",h.rangeBand()+5).attr("x2",h.rangeBand()/(1-padding)-5)}var d=d3.select("#waterfall"),e={top:20,right:20,bottom:30,left:50},f=d.node().getBoundingClientRect().width-e.left-e.right,g=500-e.top-e.bottom;padding=.3;var h=d3.scale.ordinal().rangeRoundBands([0,f],padding),i=d3.scale.linear().range([g,0]),j=d3.svg.axis().scale(h).orient("bottom"),k=d3.svg.axis().scale(i).orient("left").tickFormat(function(a){return b(a)}),l=d.append("svg"),m=l.attr("width",f+e.left+e.right).attr("height",g+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");d3.csv("robust-assets/demo-data/d3/bar/waterfall.csv",a,function(a,c){if(a)throw a;for(var d=0,e=0;e<c.length;e++)c[e].start=d,d+=c[e].value,c[e].end=d,c[e]["class"]=c[e].value>=0?"positive":"negative";c.push({name:"Total",end:d,start:0,"class":"total"}),h.domain(c.map(function(a){return a.name})),i.domain([0,d3.max(c,function(a){return a.end})]),m.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+g+")").call(j),m.append("g").attr("class","d3-axis d3-yaxis").call(k);var f=m.selectAll(".d3-bar").data(c).enter().append("g").attr("class",function(a){return"d3-bar "+a["class"]}).attr("transform",function(a){return"translate("+h(a.name)+",0)"});f.append("rect").attr("y",function(a){return i(Math.max(a.start,a.end))}).attr("height",function(a){return Math.abs(i(a.start)-i(a.end))}).attr("width",h.rangeBand()),f.append("text").attr("x",h.rangeBand()/2).attr("y",function(a){return i(a.end)+5}).attr("dy",function(a){return("negative"==a["class"]?"-":"")+".75em"}).text(function(a){return b(a.end-a.start)}),f.filter(function(a){return"total"!=a["class"]}).append("line").attr("class","d3-connector").attr("x1",h.rangeBand()+5).attr("y1",function(a){return i(a.end)}).attr("x2",h.rangeBand()/(1-padding)-5).attr("y2",function(a){return i(a.end)})}),$(window).on("resize",c),$(".menu-toggle").on("click",c)});