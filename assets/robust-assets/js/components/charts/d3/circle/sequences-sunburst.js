$(window).on("load",function(){function a(a){e(),h(),d3.select("#togglelegend").on("click",i),r.append("svg:circle").attr("r",n).style("opacity",0);var d=s.nodes(a).filter(function(a){return a.dx>.005}),f=r.data([a]).selectAll("path").data(d).enter().append("svg:path").attr("display",function(a){return a.depth?null:"none"}).attr("d",t).attr("fill-rule","evenodd").style("fill",function(a){return p[a.name]}).style("opacity",1).on("mouseover",b);d3.select("#container").on("mouseleave",c),q=f.node().__data__.value}function b(a){var b=(100*a.value/q).toPrecision(3),c=b+"%";b<.1&&(c="< 0.1%"),d3.select("#percentage").text(c),d3.select("#explanation").style("visibility","");var e=d(a);g(e,c),k.selectAll("path").style("opacity",.3),r.selectAll("path").filter(function(a){return e.indexOf(a)>=0}).style("opacity",1)}function c(a){d3.select("#trail").style("visibility","hidden"),k.selectAll("path").on("mouseover",null),k.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",b)}),d3.select("#explanation").style("visibility","hidden")}function d(a){for(var b=[],c=a;c.parent;)b.unshift(c),c=c.parent;return b}function e(){var a=d3.select("#sequence").append("svg:svg").attr("width",l).attr("height",50).attr("id","trail");a.append("svg:text").attr("id","endlabel").style("fill","#000")}function f(a,b){var c=[];return c.push("0,0"),c.push(o.w+",0"),c.push(o.w+o.t+","+o.h/2),c.push(o.w+","+o.h),c.push("0,"+o.h),b>0&&c.push(o.t+","+o.h/2),c.join(" ")}function g(a,b){var c=d3.select("#trail").selectAll("g").data(a,function(a){return a.name+a.depth}),d=c.enter().append("svg:g");d.append("svg:polygon").attr("points",f).style("fill",function(a){return p[a.name]}),d.append("svg:text").attr("x",(o.w+o.t)/2).attr("y",o.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(a){return a.name}),c.attr("transform",function(a,b){return"translate("+b*(o.w+o.s)+", 0)"}),c.exit().remove(),d3.select("#trail").select("#endlabel").attr("x",(a.length+.5)*(o.w+o.s)).attr("y",o.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(b),d3.select("#trail").style("visibility","")}function h(){var a={w:75,h:30,s:3,r:3},b=d3.select("#legend").append("svg:svg").attr("width",a.w).attr("height",d3.keys(p).length*(a.h+a.s)),c=b.selectAll("g").data(d3.entries(p)).enter().append("svg:g").attr("transform",function(b,c){return"translate(0,"+c*(a.h+a.s)+")"});c.append("svg:rect").attr("rx",a.r).attr("ry",a.r).attr("width",a.w).attr("height",a.h).style("fill",function(a){return a.value}),c.append("svg:text").attr("x",a.w/2).attr("y",a.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(a){return a.key})}function i(){var a=d3.select("#legend");"hidden"==a.style("visibility")?a.style("visibility",""):a.style("visibility","hidden")}function j(a){for(var b={name:"root",children:[]},c=0;c<a.length;c++){var d=a[c][0],e=+a[c][1];if(!isNaN(e))for(var f=d.split("-"),g=b,h=0;h<f.length;h++){var i,j=g.children,k=f[h];if(h+1<f.length){for(var l=!1,m=0;m<j.length;m++)if(j[m].name==k){i=j[m],l=!0;break}l||(i={name:k,children:[]},j.push(i)),g=i}else i={name:k,size:e},j.push(i)}}return b}var k=d3.select("#sunburst-sequence"),l=k.node().getBoundingClientRect().width,m=400,n=Math.min(l,m)/2,o={w:75,h:30,s:3,t:10},p={home:"#99B898",product:"#FECEA8",search:"#FF847C",account:"#E84A5F",other:"#6C5B7B",end:"#355C7D"},q=0,r=k.append("svg:svg").attr("width",l).attr("height",m).append("svg:g").attr("id","container").attr("transform","translate("+l/2+","+m/2+")"),s=d3.layout.partition().size([2*Math.PI,n*n]).value(function(a){return a.size}),t=d3.svg.arc().startAngle(function(a){return a.x}).endAngle(function(a){return a.x+a.dx}).innerRadius(function(a){return Math.sqrt(a.y)}).outerRadius(function(a){return Math.sqrt(a.y+a.dy)});d3.text("robust-assets/demo-data/d3/circle/visit-sequences.csv",function(b){var c=d3.csv.parseRows(b),d=j(c);a(d)})});