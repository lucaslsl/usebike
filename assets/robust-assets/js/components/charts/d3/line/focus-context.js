$(window).on("load",function(){function a(){j.domain(q.empty()?k.domain():q.extent()),v.select(".d3-area").attr("d",r),v.select("d3-xaxis").call(n)}function b(a){return a.date=i(a.date),a.price=+a.price,a}function c(){g=d.node().getBoundingClientRect().width-e.left-e.right,t.attr("width",g+e.left+e.right),u.attr("width",g+e.left+e.right),j.range([0,g]),k.range([0,g]),u.selectAll(".d3-xaxis").call(n),u.selectAll(".d3-focus-area").attr("d",r),u.selectAll(".d3-context-area").attr("d",s)}var d=d3.select("#focus-context"),e={top:10,right:10,bottom:100,left:40},f={top:430,right:10,bottom:20,left:40},g=d.node().getBoundingClientRect().width-e.left-e.right,h=500-e.top-e.bottom;height2=500-f.top-f.bottom;var i=d3.time.format("%b %Y").parse,j=d3.time.scale().range([0,g]),k=d3.time.scale().range([0,g]),l=d3.scale.linear().range([h,0]),m=d3.scale.linear().range([height2,0]),n=d3.svg.axis().scale(j).orient("bottom"),o=d3.svg.axis().scale(k).orient("bottom"),p=d3.svg.axis().scale(l).orient("left"),q=d3.svg.brush().x(k).on("brush",a),r=d3.svg.area().interpolate("monotone").x(function(a){return j(a.date)}).y0(h).y1(function(a){return l(a.price)}),s=d3.svg.area().interpolate("monotone").x(function(a){return k(a.date)}).y0(height2).y1(function(a){return m(a.price)}),t=d.append("svg"),u=t.attr("width",g+e.left+e.right).attr("height",h+e.top+e.bottom);u.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",g).attr("height",h);var v=u.append("g").attr("class","focus").attr("transform","translate("+e.left+","+e.top+")"),w=u.append("g").attr("class","context").attr("transform","translate("+f.left+","+f.top+")");d3.csv("robust-assets/demo-data/d3/line/focus-context.csv",b,function(a,b){if(a)throw a;j.domain(d3.extent(b.map(function(a){return a.date}))),l.domain([0,d3.max(b.map(function(a){return a.price}))]),k.domain(j.domain()),m.domain(l.domain()),v.append("path").datum(b).attr("class","d3-area d3-focus-area").attr("d",r).style("fill","#5C6BC0"),v.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+h+")").call(n),v.append("g").attr("class","d3-axis d3-yaxis").call(p),w.append("path").datum(b).attr("class","d3-area d3-context-area").attr("d",s).style("fill","#5C6BC0"),w.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+height2+")").call(o),w.append("g").attr("class","d3-xbrush").call(q).selectAll("rect").attr("y",-6).attr("height",height2+7).style("fill-opacity",".225")}),$(window).on("resize",c),$(".menu-toggle").on("click",c)});