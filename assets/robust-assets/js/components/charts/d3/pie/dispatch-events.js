$(window).on("load",function(){function a(a){return a.total=d3.sum(d,function(b){return a[b]=+a[b]}),a}var b=d3.dispatch("load","statechange"),c=d3.select("#disptach-events"),d=["Under 5 Years","5 to 13 Years","14 to 17 Years","18 to 24 Years","25 to 44 Years","45 to 64 Years","65 Years and Over"];d3.csv("robust-assets/demo-data/d3/pie/dispatch-events.csv",a,function(a,c){if(a)throw a;var d=d3.map();c.forEach(function(a){d.set(a.id,a)}),b.load(d),b.statechange(d.get("CA"))}),b.on("load.menu",function(a){var d=c.append("div").append("select").on("change",function(){b.statechange(a.get(this.value))});d.selectAll("option").data(a.values()).enter().append("option").attr("value",function(a){return a.id}).text(function(a){return a.id}),b.on("statechange.menu",function(a){d.property("value",a.id)})}),b.on("load.bar",function(a){var d={top:20,right:20,bottom:30,left:40},e=80-d.left-d.right,f=460-d.top-d.bottom,g=d3.scale.linear().domain([0,d3.max(a.values(),function(a){return a.total})]).rangeRound([f,0]).nice(),h=d3.svg.axis().scale(g).orient("left").tickFormat(d3.format(".2s")),i=c.append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")");i.append("g").attr("class","y axis").call(h);var j=i.append("rect").attr("x",4).attr("width",e-4).attr("y",f).attr("height",0).style("fill","#aaa");b.on("statechange.bar",function(a){j.transition().attr("y",g(a.total)).attr("height",g(0)-g(a.total))})}),b.on("load.pie",function(a){var e=c.node().getBoundingClientRect().width-100,f=460,g=Math.min(e,f)/2,h=d3.scale.ordinal().domain(d).range(["#99B898","#FECEA8","#FF847C","#E84A5F","#F8B195","#F67280","#C06C84"]),i=d3.svg.arc().outerRadius(g-10).innerRadius(g-70),j=d3.layout.pie().sort(null),k=c.append("svg").attr("width",e).attr("height",f).append("g").attr("transform","translate("+e/2+","+f/2+")"),l=k.selectAll("path").data(d).enter().append("path").style("fill",h).each(function(){this._current={startAngle:0,endAngle:0}});b.on("statechange.pie",function(a){l.data(j.value(function(b){return a[b]})(d)).transition().attrTween("d",function(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return i(b(a))}})})})});